syntax = "proto3";

package msger.api.msg;

option go_package = "github.com/ryanreadbooks/whimer/msger/api/msg";

import "buf/validate/validate.proto";

message StringList {
  repeated string items = 1;
}

// 消息类型枚举
enum MsgType {
  MSG_TYPE_UNSPECIFIED = 0;
  MSG_TYPE_TEXT        = 1;   // 文本消息
  MSG_TYPE_IMAGE       = 10;  // 图片
  MSG_TYPE_VIDEO       = 20;  // 视频
}

// 消息状态
enum MsgStatus {
  MSG_STATUS_UNSPECIFIED = 0;
  MSG_STATUS_NORMAL      = 1;  // 正常
  MSG_STATUS_RECALL      = 2;  // 撤回
}

// 消息定义
message Msg {
  string          id     = 1;
  MsgType         type   = 2;
  MsgStatus       status = 3;
  int64           sender = 4;
  int64           mtime  = 5;
  string          cid    = 6;
  MsgExt          ext    = 7;
  MsgContentText  text   = 8;  // type = text时有效
  MsgContentImage image  = 9;  // type = image时有效
}

message MsgContentText {
  string content = 1;
  string preview = 2;
}

message MsgExt {
  MsgExtRecall recall = 1;
}

message MsgExtRecall {
  int64 uid  = 1;
  int64 time = 2;
}

message MsgContentImage {
  string key          = 1 [(buf.validate.field).string.min_len = 1];
  uint32 height       = 2 [(buf.validate.field).uint32.gt = 0];
  uint32 width        = 3 [(buf.validate.field).uint32.gt = 0];
  string format       = 4;  // mime type for image
  string preview_text = 5;
}
